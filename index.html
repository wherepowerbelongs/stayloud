<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Representative Voting Tracker</title>
    <link href="style.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h1>Track How Your Representative Voted!</h1>
        
        <!-- Form for user input -->
        <form id="voting-form">
            <label for="zipcode">Enter Your ZIP Code:</label>
            <input type="text" id="zipcode" name="zipcode" required>
            
            <label for="topic">Select a Topic You Care About:</label>
            <select id="topic">
                <option value="">Loading topics...</option> <!-- Placeholder while fetching -->
            </select>

            <label for="side">Choose Your Position:</label>
            <select id="side">
                <option value="pro">Pro</option>
                <option value="against">Against</option>
            </select>
            
            <button type="submit">Get Voting Record</button>
        </form>

        <div id="result">
            <!-- This is where the voting record will be displayed -->
        </div>
    </div>

    <!-- Fetch Topics Script -->
    <script>
        async function fetchAndMergeTopics() {
            const apiUrl = "https://www.govtrack.us/api/v2/bill?order_by=-introduced_date&limit=20"; // Fetch latest 20 bills

            try {
                // Fetch topics from GovTrack API
                let apiResponse = await fetch(apiUrl);
                let apiData = await apiResponse.json();

                // Extract topics (GovTrack bills have a "title" field)
                let apiTopics = apiData.objects.map(bill => bill.title);

                // Fetch local topics from topics.json
                let jsonResponse = await fetch("topics.json");
                let localData = await jsonResponse.json();
                let localTopics = localData.topics;

                // Merge API topics with local topics (avoid duplicates)
                let mergedTopics = [...new Set([...localTopics, ...apiTopics])];

                // Update the dropdown dynamically
                const topicDropdown = document.getElementById("topic");
                topicDropdown.innerHTML = ""; // Clear existing options

                mergedTopics.forEach(topic => {
                    let option = document.createElement("option");
                    option.value = topic.toLowerCase().replace(/\s+/g, "_"); // Format value
                    option.textContent = topic; // Display text
                    topicDropdown.appendChild(option);
                });

            } catch (error) {
                console.error("Error fetching topics:", error);
            }
        }

        // Run function when page loads
        fetchAndMergeTopics();
    </script>

    <script src="script.js"></script>
</body>
</html>